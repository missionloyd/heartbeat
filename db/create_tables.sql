
CREATE TABLE IF NOT EXISTS public.asset(
  id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  active BOOLEAN NOT NULL,
  name VARCHAR(255) NOT NULL,
  tree_id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  lft INTEGER NOT NULL,
  rght INTEGER NOT NULL
);


CREATE TABLE IF NOT EXISTS public.commodity(
  id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  type VARCHAR(255) NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS public.measurement(
  id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  asset_id INTEGER NOT NULL,
  commodity_id INTEGER NOT NULL,
  ts timestamp without time zone default (now() at time zone 'utc'),
  value NUMERIC NOT NULL,
  FOREIGN KEY(asset_id) REFERENCES asset(id),
  FOREIGN KEY(commodity_id) REFERENCES commodity(id)
);


CREATE TABLE IF NOT EXISTS public.metadata(
  id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  asset_id INTEGER NOT NULL,
  data JSONB NOT NULL,
  FOREIGN KEY(asset_id) REFERENCES asset(id)
);
